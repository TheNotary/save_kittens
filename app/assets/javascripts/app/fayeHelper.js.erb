window.APP.fayeHelper = {
  initFayeClient: function() {
    var url = location.protocol + "//" + document.domain + ":8000/faye"; // eg 'http://localhost:8000/faye'
    var fayeClient = new Faye.Client(url).on('transport:up', function() {
      // the client is online, disable polling...
      window.APP.intervals.ClearAll();
    });
    fayeClient.subscriptions = [];

    window.APP.fayeClient = fayeClient;
  },
  newSubscription: function(channel, messageProcessingCallback) {

    try {
      var subscription = APP.fayeClient.subscribe(channel, function(message) {
        // message: {"signatureCount":54,"topThreeStates":["CA"]}
        messageProcessingCallback(message)
      });

      APP.fayeClient.subscriptions.push(subscription);
    }
    catch (err) {
      console.log(xinspect(err));
    }

  },
  changeChannel: function(channel, messageProcessingCallback) {
    if (APP.fayeClient.subscriptions.length > 0)
      for (var i = 0; i < fayeClient.length; i++)
        APP.fayeClient.subscriptions[i].cancel();

    APP.fayeClient.subscriptions = [];

    APP.fayeHelper.newSubscription(channel, messageProcessingCallback);
  }
};

APP.fayeHelper.initFayeClient();
